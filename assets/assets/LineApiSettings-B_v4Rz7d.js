import{r as w,b as h,d as k,w as C,c as u,a as t,i as f,v as y,q as _,D as S,o as c}from"./main-CKplmvXD.js";const A={class:"space-y-6"},E={class:"flex items-center justify-between"},T=["disabled"],U={key:0},N={key:1},D={class:"bg-white rounded-lg border border-gray-200 shadow-sm"},F={class:"px-6 py-6 space-y-6"},R={class:"flex gap-2"},B=["value"],$={class:"flex gap-2"},j=["value"],M={class:"flex justify-end pt-6 border-t border-gray-200"},P=["disabled"],V={key:0},W={key:1},q={__name:"LineApiSettings",setup(K,{expose:I}){const L=S(),o=w({channelAccessToken:"",channelSecret:"",liffId:""}),l=w(!1),m=h(()=>{var n,a;const s=((n=window.buygo_admin)==null?void 0:n.rest_url)||((a=window.buygo_admin)==null?void 0:a.api_url)||"";return s?s.replace(/\/$/,"")+"/"+"line-webhook":""}),b=h(()=>{var e;const s=((e=window.buygo_admin)==null?void 0:e.home_url)||"";return s?s.replace(/\/$/,"")+"/wp-content/plugins/buygo-plus-one/public/liff-share-product.php":""}),x=async()=>{var s,e,n,a,d;try{const g=`${((s=window.buygo_admin)==null?void 0:s.api_url)||((e=window.buygo_admin)==null?void 0:e.rest_url)||"/wp-json/buygo/v1"}/settings/line`,i=await _.get(g,{headers:{"X-WP-Nonce":(n=window.buygo_admin)==null?void 0:n.nonce}});i.data.success&&i.data.data&&(o.value={channelAccessToken:i.data.data.channelAccessToken||"",channelSecret:i.data.data.channelSecret||"",liffId:i.data.data.liffId||""})}catch(r){console.error("載入設定失敗:",r),alert("載入設定失敗: "+(((d=(a=r.response)==null?void 0:a.data)==null?void 0:d.message)||r.message))}},p=async()=>{var s,e,n,a,d;l.value=!0;try{const r=((s=window.buygo_admin)==null?void 0:s.api_url)||((e=window.buygo_admin)==null?void 0:e.rest_url)||"/wp-json/buygo/v1",g=await _.post(`${r}/settings/line`,{channelAccessToken:o.value.channelAccessToken,channelSecret:o.value.channelSecret,liffId:o.value.liffId},{headers:{"X-WP-Nonce":(n=window.buygo_admin)==null?void 0:n.nonce,"Content-Type":"application/json"}});g.data.success?alert("設定已成功儲存"):alert("儲存失敗: "+(g.data.message||"未知錯誤"))}catch(r){console.error("儲存設定失敗:",r),alert("儲存失敗: "+(((d=(a=r.response)==null?void 0:a.data)==null?void 0:d.message)||r.message))}finally{l.value=!1}},v=async s=>{try{await navigator.clipboard.writeText(s),alert("已複製到剪貼簿")}catch(e){console.error("複製失敗:",e),alert("複製失敗")}};return I({saveSettings:p}),k(()=>{x()}),C(()=>L.path,s=>{(s==="/settings/line/api"||s.includes("/settings/line/api"))&&x()},{immediate:!0}),k(()=>{const s=e=>{(e.metaKey||e.ctrlKey)&&e.key==="s"&&(e.preventDefault(),l.value||p())};return window.addEventListener("keydown",s),()=>{window.removeEventListener("keydown",s)}}),(s,e)=>(c(),u("div",A,[t("div",E,[e[6]||(e[6]=t("div",null,[t("h1",{class:"text-2xl font-semibold text-gray-900"},"LINE Messaging API 設定"),t("p",{class:"mt-1 text-sm text-gray-500"},"連結您的 LINE 官方帳號以啟用通知與互動功能")],-1)),t("button",{onClick:p,disabled:l.value,class:"inline-flex items-center gap-2 px-4 py-2 bg-gray-900 text-white text-sm font-medium rounded-md hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-900 disabled:opacity-50 disabled:cursor-not-allowed"},[l.value?(c(),u("span",U,"儲存中...")):(c(),u("span",N,"儲存")),e[5]||(e[5]=t("kbd",{class:"hidden sm:inline-flex items-center px-2 py-0.5 text-xs font-semibold text-gray-400 bg-gray-800 border border-gray-700 rounded"},"⌘S",-1))],8,T)]),t("div",D,[e[17]||(e[17]=t("div",{class:"px-6 py-5 border-b border-gray-200"},[t("h2",{class:"text-lg font-medium text-gray-900"},"LINE Messaging API"),t("p",{class:"mt-1 text-sm text-gray-500"},"設定您的 LINE Messaging API 憑證")],-1)),t("div",F,[t("div",null,[e[7]||(e[7]=t("label",{for:"channel_access_token",class:"block text-sm font-medium text-gray-700 mb-1.5"}," Channel Access Token ",-1)),f(t("input",{id:"channel_access_token","onUpdate:modelValue":e[0]||(e[0]=n=>o.value.channelAccessToken=n),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent text-sm",placeholder:"請輸入您的 Channel Access Token"},null,512),[[y,o.value.channelAccessToken]]),e[8]||(e[8]=t("p",{class:"mt-1.5 text-xs text-gray-500"},"從 LINE Developers Console 取得的 Channel Access Token",-1))]),t("div",null,[e[9]||(e[9]=t("label",{for:"channel_secret",class:"block text-sm font-medium text-gray-700 mb-1.5"}," Channel Secret ",-1)),f(t("input",{id:"channel_secret","onUpdate:modelValue":e[1]||(e[1]=n=>o.value.channelSecret=n),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent text-sm",placeholder:"請輸入您的 Channel Secret"},null,512),[[y,o.value.channelSecret]]),e[10]||(e[10]=t("p",{class:"mt-1.5 text-xs text-gray-500"},"從 LINE Developers Console 取得的 Channel Secret",-1))]),t("div",null,[e[11]||(e[11]=t("label",{for:"liff_id",class:"block text-sm font-medium text-gray-700 mb-1.5"}," LIFF ID ",-1)),f(t("input",{id:"liff_id","onUpdate:modelValue":e[2]||(e[2]=n=>o.value.liffId=n),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent text-sm",placeholder:"1234567890-abcdefgh"},null,512),[[y,o.value.liffId]]),e[12]||(e[12]=t("p",{class:"mt-1.5 text-xs text-gray-500"},"用於分享商品卡片功能，請在 LINE Developers Console 建立 LIFF app",-1))]),t("div",null,[e[13]||(e[13]=t("label",{for:"webhook_url",class:"block text-sm font-medium text-gray-700 mb-1.5"}," Webhook URL ",-1)),t("div",R,[t("input",{id:"webhook_url",value:m.value,type:"text",readonly:"",class:"flex-1 px-3 py-2 border border-gray-300 rounded-md bg-gray-50 text-sm text-gray-600"},null,8,B),t("button",{onClick:e[3]||(e[3]=n=>v(m.value)),class:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-900"}," 複製 ")]),e[14]||(e[14]=t("p",{class:"mt-1.5 text-xs text-gray-500"},"請將此 URL 設定到 LINE Developers Console 的 Webhook URL",-1))]),t("div",null,[e[15]||(e[15]=t("label",{for:"liff_endpoint_url",class:"block text-sm font-medium text-gray-700 mb-1.5"}," LIFF Endpoint URL ",-1)),t("div",$,[t("input",{id:"liff_endpoint_url",value:b.value,type:"text",readonly:"",class:"flex-1 px-3 py-2 border border-gray-300 rounded-md bg-gray-50 text-sm text-gray-600"},null,8,j),t("button",{onClick:e[4]||(e[4]=n=>v(b.value)),class:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-900"}," 複製 ")]),e[16]||(e[16]=t("p",{class:"mt-1.5 text-xs text-gray-500"},"請將此 URL 設定為 LIFF app 的 Endpoint URL",-1))])])]),t("div",M,[t("button",{onClick:p,disabled:l.value,class:"inline-flex items-center gap-2 px-4 py-2 bg-gray-900 text-white text-sm font-medium rounded-md hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-900 disabled:opacity-50 disabled:cursor-not-allowed"},[l.value?(c(),u("span",V,"儲存中...")):(c(),u("span",W,"儲存")),e[18]||(e[18]=t("kbd",{class:"hidden sm:inline-flex items-center px-2 py-0.5 text-xs font-semibold text-gray-400 bg-gray-800 border border-gray-700 rounded"},"⌘S",-1))],8,P)])]))}};export{q as default};
