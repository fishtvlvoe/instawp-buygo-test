import{r as v,c as n,o,a as e,t as r,k as L,z as E,F as j,l as S,m as P,i as O,H as ue,g,v as Z,h as R,_ as K,N as ce,b as me,w as ge,d as pe,f as W,J as F,I as xe,u as ve}from"./main-CKplmvXD.js";import{_ as q}from"./StatusBadge-BM6RTk6K.js";const ye={class:"mb-4 p-3 bg-gray-50 rounded-lg"},fe={class:"text-sm font-medium text-gray-900"},be={class:"text-sm text-gray-500"},he={class:"text-sm text-gray-500"},we={class:"mb-4"},_e={class:"space-y-2"},ke=["onClick"],$e=["value"],Ce={class:"flex-1"},je={class:"flex items-center"},Se={key:0,class:"ml-2 text-xs text-red-600 font-medium"},Me={key:0,class:"text-xs text-red-600 mt-1"},Le={class:"mb-6"},Ae={class:"flex justify-end space-x-3"},Be=["disabled"],Te={key:0},Oe={key:1},De={__name:"StatusUpdateModal",props:{order:{type:Object,required:!0},availableStatuses:{type:Array,required:!0}},emits:["close","updated"],setup(d,{emit:$}){var u;const _=d,c=$,f=v(""),h=v(""),x=v(!1),y=((u=window.buygo_admin)==null?void 0:u.api_url)||"/wp-json/buygo/v1",s=()=>{c("close")},i=async()=>{var w;if(f.value){x.value=!0;try{const m=await fetch(`${y}/orders/${_.order.id}/shipping-status`,{method:"PUT",headers:{"Content-Type":"application/json","X-WP-Nonce":((w=window.buygo_admin)==null?void 0:w.nonce)||""},body:JSON.stringify({status:f.value,reason:h.value})}),p=await m.json();if(!m.ok||!p.success)throw new Error(p.message||"更新失敗");c("updated")}catch(m){alert("更新失敗："+m.message)}finally{x.value=!1}}};return(w,m)=>(o(),n("div",{class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",onClick:s},[e("div",{class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",onClick:m[2]||(m[2]=R(()=>{},["stop"]))},[e("div",{class:"flex items-center justify-between mb-4"},[m[4]||(m[4]=e("h3",{class:"text-lg font-medium text-gray-900"},"更新運送狀態",-1)),e("button",{onClick:s,class:"text-gray-400 hover:text-gray-600 focus:outline-none"},[...m[3]||(m[3]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",ye,[e("div",fe,r(d.order.order_number),1),e("div",be,r(d.order.customer_name),1),e("div",he,[m[5]||(m[5]=L("當前狀態： ",-1)),E(q,{status:d.order.shipping_status},null,8,["status"])])]),e("div",we,[m[6]||(m[6]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"新狀態",-1)),e("div",_e,[(o(!0),n(j,null,S(d.availableStatuses,p=>(o(),n("div",{key:p.key,class:P(["flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50",{"border-blue-500 bg-blue-50":f.value===p.key,"border-red-300 bg-red-50":p.is_abnormal}]),onClick:A=>f.value=p.key},[O(e("input",{type:"radio",value:p.key,"onUpdate:modelValue":m[0]||(m[0]=A=>f.value=A),class:"mr-3 text-blue-600 focus:ring-blue-500"},null,8,$e),[[ue,f.value]]),e("div",Ce,[e("div",je,[E(q,{status:p.key},null,8,["status"]),p.is_abnormal?(o(),n("span",Se," 異常變更 ")):g("",!0)]),p.warning?(o(),n("div",Me,r(p.warning),1)):g("",!0)])],10,ke))),128))])]),e("div",Le,[m[7]||(m[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"變更原因",-1)),O(e("textarea",{"onUpdate:modelValue":m[1]||(m[1]=p=>h.value=p),rows:"3",class:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"請輸入狀態變更的原因（選填）"},null,512),[[Z,h.value]])]),e("div",Ae,[e("button",{onClick:s,class:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"}," 取消 "),e("button",{onClick:i,disabled:!f.value||x.value,class:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50"},[x.value?(o(),n("span",Te,"更新中...")):(o(),n("span",Oe,"確認更新"))],8,Be)])])]))}},ze={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},Ne={class:"bg-gray-50 p-4 rounded-lg"},Ue={class:"space-y-2"},Ve={class:"flex justify-between"},Pe={class:"font-medium"},Ie={class:"flex justify-between"},Ee={class:"font-medium"},qe={key:0,class:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800"},We={class:"flex justify-between"},Fe={class:"font-medium"},Re={class:"flex justify-between"},He={class:"font-medium text-lg"},Je={class:"flex justify-between"},Ge={class:"bg-gray-50 p-4 rounded-lg"},Xe={class:"space-y-2"},Ze={class:"flex justify-between"},Ke={class:"font-medium"},Qe={class:"flex justify-between"},Ye={class:"font-medium"},et={class:"flex justify-between"},tt={class:"font-medium"},st={class:"mt-1 text-sm"},ot={key:0,class:"mb-6"},nt={class:"bg-gray-50 p-4 rounded-lg"},rt={class:"flex flex-wrap gap-2"},lt={class:"mb-6"},it={class:"bg-white border border-gray-200 rounded-lg overflow-hidden"},at={key:0},dt={class:"overflow-x-auto"},ut={class:"min-w-full divide-y divide-gray-200"},ct={class:"bg-white divide-y divide-gray-200"},mt={class:"px-6 py-4 whitespace-nowrap"},gt={class:"text-sm font-medium text-gray-900"},pt={key:0,class:"text-sm text-gray-500"},xt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},vt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},yt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},ft={class:"px-6 py-4 whitespace-nowrap"},bt={class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"},ht={key:1,class:"p-8 text-center text-gray-500"},wt={key:1,class:"mb-6"},_t={class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},kt={class:"flex items-center mb-2"},$t={class:"text-sm font-medium text-yellow-800"},Ct={class:"text-sm text-yellow-700"},jt={__name:"OrderDetailsModal",props:{order:{type:Object,required:!0}},emits:["close"],setup(d,{emit:$}){const _=$,c=()=>{_("close")},f=y=>y?new Date(y).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",h=y=>y?`NT$ ${(typeof y=="string"?parseFloat(y):y).toLocaleString("zh-TW")}`:"NT$ 0",x=()=>{window.print()};return(y,s)=>(o(),n("div",{class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",onClick:c},[e("div",{class:"relative top-10 mx-auto p-5 border max-w-4xl shadow-lg rounded-md bg-white",onClick:s[0]||(s[0]=R(()=>{},["stop"]))},[e("div",{class:"flex items-center justify-between mb-6"},[s[2]||(s[2]=e("h3",{class:"text-xl font-medium text-gray-900"},"訂單詳情",-1)),e("button",{onClick:c,class:"text-gray-400 hover:text-gray-600 focus:outline-none"},[...s[1]||(s[1]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",ze,[e("div",Ne,[s[8]||(s[8]=e("h4",{class:"text-lg font-medium text-gray-900 mb-3"},"基本資訊",-1)),e("div",Ue,[e("div",Ve,[s[3]||(s[3]=e("span",{class:"text-gray-600"},"訂單編號：",-1)),e("span",Pe,r(d.order.order_number),1)]),e("div",Ie,[s[4]||(s[4]=e("span",{class:"text-gray-600"},"訂單類型：",-1)),e("span",Ee,[L(r(d.order.is_consolidated?"合併訂單":"一般訂單")+" ",1),d.order.is_consolidated?(o(),n("span",qe," 合併 ")):g("",!0)])]),e("div",We,[s[5]||(s[5]=e("span",{class:"text-gray-600"},"建立時間：",-1)),e("span",Fe,r(f(d.order.created_at)),1)]),e("div",Re,[s[6]||(s[6]=e("span",{class:"text-gray-600"},"訂單金額：",-1)),e("span",He,r(d.order.formatted_total_amount),1)]),e("div",Je,[s[7]||(s[7]=e("span",{class:"text-gray-600"},"運送狀態：",-1)),E(q,{status:d.order.shipping_status},null,8,["status"])])])]),e("div",Ge,[s[13]||(s[13]=e("h4",{class:"text-lg font-medium text-gray-900 mb-3"},"客戶資訊",-1)),e("div",Xe,[e("div",Ze,[s[9]||(s[9]=e("span",{class:"text-gray-600"},"姓名：",-1)),e("span",Ke,r(d.order.customer_name),1)]),e("div",Qe,[s[10]||(s[10]=e("span",{class:"text-gray-600"},"電話：",-1)),e("span",Ye,r(d.order.customer_phone||"未提供"),1)]),e("div",et,[s[11]||(s[11]=e("span",{class:"text-gray-600"},"Email：",-1)),e("span",tt,r(d.order.customer_email||"未提供"),1)]),e("div",null,[s[12]||(s[12]=e("span",{class:"text-gray-600"},"運送地址：",-1)),e("div",st,r(d.order.shipping_address||"未提供"),1)])])])]),d.order.sellers&&d.order.sellers.length>0?(o(),n("div",ot,[s[14]||(s[14]=e("h4",{class:"text-lg font-medium text-gray-900 mb-3"},"賣家資訊",-1)),e("div",nt,[e("div",rt,[(o(!0),n(j,null,S(d.order.sellers,i=>(o(),n("span",{key:i.id,class:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800"},r(i.name),1))),128))])])])):g("",!0),e("div",lt,[s[16]||(s[16]=e("h4",{class:"text-lg font-medium text-gray-900 mb-3"},"商品清單",-1)),e("div",it,[d.order.items&&d.order.items.length>0?(o(),n("div",at,[e("div",dt,[e("table",ut,[s[15]||(s[15]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," 商品名稱 "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," 數量 "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," 單價 "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," 小計 "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," 狀態 ")])],-1)),e("tbody",ct,[(o(!0),n(j,null,S(d.order.items,i=>(o(),n("tr",{key:i.id},[e("td",mt,[e("div",gt,r(i.product_name),1),i.variation_title?(o(),n("div",pt,r(i.variation_title),1)):g("",!0)]),e("td",xt,r(i.quantity),1),e("td",vt,r(h(i.item_price)),1),e("td",yt,r(h(i.line_total)),1),e("td",ft,[e("span",bt,r(i.arrival_status==="arrived"?"已到貨":"待到貨"),1)])]))),128))])])])])):(o(),n("div",ht," 沒有商品資訊 "))])]),d.order.is_consolidated&&d.order.original_order_ids?(o(),n("div",wt,[s[18]||(s[18]=e("h4",{class:"text-lg font-medium text-gray-900 mb-3"},"原始訂單",-1)),e("div",_t,[e("div",kt,[s[17]||(s[17]=e("svg",{class:"w-5 h-5 text-yellow-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",$t," 此訂單由 "+r(d.order.original_order_ids.length)+" 個原始訂單合併而成 ",1)]),e("div",Ct," 原始訂單編號："+r(d.order.original_order_ids.join(", ")),1)])])):g("",!0),e("div",{class:"flex justify-end space-x-3"},[e("button",{onClick:c,class:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"}," 關閉 "),e("button",{onClick:x,class:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500"}," 列印訂單 ")])])]))}},St=K(jt,[["__scopeId","data-v-34169de1"]]),Mt={class:"border-b border-gray-200 mb-4"},Lt={class:"-mb-px flex space-x-8"},At={class:"h-96 overflow-y-auto"},Bt={key:0,class:"space-y-3"},Tt={key:0,class:"text-center text-gray-500 py-8"},Ot={class:"flex items-center justify-between mb-2"},Dt={class:"text-sm font-medium text-gray-900"},zt={class:"text-xs text-gray-500"},Nt={class:"text-xs text-gray-600"},Ut={class:"whitespace-pre-wrap"},Vt={key:1,class:"space-y-3"},Pt={key:0,class:"text-center text-gray-500 py-8"},It={class:"flex items-center justify-between mb-2"},Et={class:"text-sm font-medium text-red-900"},qt={class:"text-xs text-red-500"},Wt={class:"text-xs text-red-700"},Ft={class:"whitespace-pre-wrap"},Rt={key:2,class:"space-y-4"},Ht={class:"bg-green-50 border border-green-200 rounded-lg p-4"},Jt={class:"grid grid-cols-2 gap-4 text-sm"},Gt={class:"text-green-600 break-all"},Xt={class:"text-green-600"},Zt={class:"text-green-600"},Kt={class:"text-green-600"},Qt={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Yt={class:"text-sm"},es={class:"text-blue-700 whitespace-pre-wrap"},ts={class:"bg-purple-50 border border-purple-200 rounded-lg p-4"},ss={class:"text-sm text-purple-700"},os={class:"font-medium"},ns={class:"ml-4 break-all"},rs={key:0,class:"text-purple-500"},ls={__name:"DebugPanel",props:{apiLogs:{type:Array,default:()=>[]},errorLogs:{type:Array,default:()=>[]}},emits:["close"],setup(d,{emit:$}){const _=$,c=v("api"),f=()=>{_("close")},h=()=>{confirm("確定要清除所有日誌嗎？")&&_("clear-logs")},x=s=>new Date(s).toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),y=()=>{const s={};for(let i=0;i<localStorage.length;i++){const u=localStorage.key(i);u&&u.includes("buygo")&&(s[u]=localStorage.getItem(u))}return s};return(s,i)=>(o(),n("div",{class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",onClick:f},[e("div",{class:"relative top-10 mx-auto p-5 border max-w-6xl shadow-lg rounded-md bg-white",onClick:i[3]||(i[3]=R(()=>{},["stop"]))},[e("div",{class:"flex items-center justify-between mb-6"},[i[5]||(i[5]=e("h3",{class:"text-xl font-medium text-gray-900"},"除錯面板",-1)),e("div",{class:"flex items-center space-x-3"},[e("button",{onClick:h,class:"px-3 py-1 text-sm bg-red-600 text-white rounded hover:bg-red-700"}," 清除日誌 "),e("button",{onClick:f,class:"text-gray-400 hover:text-gray-600 focus:outline-none"},[...i[4]||(i[4]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),e("div",Mt,[e("nav",Lt,[e("button",{onClick:i[0]||(i[0]=u=>c.value="api"),class:P(["py-2 px-1 border-b-2 font-medium text-sm",c.value==="api"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," API 日誌 ("+r(d.apiLogs.length)+") ",3),e("button",{onClick:i[1]||(i[1]=u=>c.value="error"),class:P(["py-2 px-1 border-b-2 font-medium text-sm",c.value==="error"?"border-red-500 text-red-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," 錯誤日誌 ("+r(d.errorLogs.length)+") ",3),e("button",{onClick:i[2]||(i[2]=u=>c.value="system"),class:P(["py-2 px-1 border-b-2 font-medium text-sm",c.value==="system"?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," 系統資訊 ",2)])]),e("div",At,[c.value==="api"?(o(),n("div",Bt,[d.apiLogs.length===0?(o(),n("div",Tt," 沒有 API 日誌 ")):g("",!0),(o(!0),n(j,null,S(d.apiLogs,(u,w)=>(o(),n("div",{key:w,class:"bg-gray-50 border border-gray-200 rounded-lg p-3"},[e("div",Ot,[e("span",Dt,r(u.action),1),e("span",zt,r(x(u.timestamp)),1)]),e("div",Nt,[e("pre",Ut,r(JSON.stringify(u.data,null,2)),1)])]))),128))])):g("",!0),c.value==="error"?(o(),n("div",Vt,[d.errorLogs.length===0?(o(),n("div",Pt," 沒有錯誤日誌 ")):g("",!0),(o(!0),n(j,null,S(d.errorLogs,(u,w)=>(o(),n("div",{key:w,class:"bg-red-50 border border-red-200 rounded-lg p-3"},[e("div",It,[e("span",Et,r(u.action),1),e("span",qt,r(x(u.timestamp)),1)]),e("div",Wt,[e("pre",Ft,r(JSON.stringify(u.data,null,2)),1)])]))),128))])):g("",!0),c.value==="system"?(o(),n("div",Rt,[e("div",Ht,[i[10]||(i[10]=e("h4",{class:"text-sm font-medium text-green-900 mb-3"},"系統環境",-1)),e("div",Jt,[e("div",null,[i[6]||(i[6]=e("span",{class:"text-green-700 font-medium"},"用戶代理：",-1)),e("div",Gt,r(s.navigator.userAgent),1)]),e("div",null,[i[7]||(i[7]=e("span",{class:"text-green-700 font-medium"},"螢幕解析度：",-1)),e("div",Xt,r(s.screen.width)+" × "+r(s.screen.height),1)]),e("div",null,[i[8]||(i[8]=e("span",{class:"text-green-700 font-medium"},"視窗大小：",-1)),e("div",Zt,r(s.window.innerWidth)+" × "+r(s.window.innerHeight),1)]),e("div",null,[i[9]||(i[9]=e("span",{class:"text-green-700 font-medium"},"時區：",-1)),e("div",Kt,r(Intl.DateTimeFormat().resolvedOptions().timeZone),1)])])]),e("div",Qt,[i[11]||(i[11]=e("h4",{class:"text-sm font-medium text-blue-900 mb-3"},"BuyGo 設定",-1)),e("div",Yt,[e("pre",es,r(JSON.stringify(s.window.buygoAdmin||{},null,2)),1)])]),e("div",ts,[i[12]||(i[12]=e("h4",{class:"text-sm font-medium text-purple-900 mb-3"},"本地儲存",-1)),e("div",ss,[(o(!0),n(j,null,S(y(),(u,w)=>(o(),n("div",{key:w,class:"mb-2"},[e("span",os,r(w)+":",1),e("div",ns,r(u),1)]))),128)),Object.keys(y()).length===0?(o(),n("div",rs," 沒有相關的本地儲存資料 ")):g("",!0)])])])):g("",!0)])])]))}},is={class:"space-y-6 pt-2"},as={class:"flex items-center justify-between"},ds={class:"flex space-x-3"},us=["disabled"],cs={key:0,class:"bg-white shadow-sm rounded-lg border border-gray-200 p-4"},ms={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},gs=["value"],ps={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},xs={class:"bg-white overflow-hidden shadow-sm rounded-lg border border-gray-200"},vs={class:"p-5"},ys={class:"flex items-center"},fs={class:"ml-5 w-0 flex-1"},bs={class:"text-lg font-medium text-gray-900"},hs={class:"bg-white overflow-hidden shadow-sm rounded-lg border border-gray-200"},ws={class:"p-5"},_s={class:"flex items-center"},ks={class:"ml-5 w-0 flex-1"},$s={class:"text-lg font-medium text-gray-900"},Cs={class:"bg-white overflow-hidden shadow-sm rounded-lg border border-gray-200"},js={class:"p-5"},Ss={class:"flex items-center"},Ms={class:"ml-5 w-0 flex-1"},Ls={class:"text-lg font-medium text-gray-900"},As={class:"bg-white overflow-hidden shadow-sm rounded-lg border border-gray-200"},Bs={class:"p-5"},Ts={class:"flex items-center"},Os={class:"ml-5 w-0 flex-1"},Ds={class:"text-lg font-medium text-gray-900"},zs={key:1,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Ns={class:"flex items-center justify-between"},Us={class:"flex items-center"},Vs={class:"text-sm font-medium text-blue-900"},Ps={class:"flex space-x-3"},Is=["value"],Es=["disabled"],qs={key:0},Ws={key:1},Fs={class:"bg-white shadow-sm rounded-lg border border-gray-200"},Rs={key:0,class:"p-8 text-center"},Hs={key:1,class:"p-8 text-center"},Js={class:"text-gray-500 mb-4"},Gs={key:2,class:"overflow-x-auto"},Xs={class:"min-w-full divide-y divide-gray-200"},Zs={class:"bg-gray-50"},Ks={class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Qs=["checked"],Ys={class:"bg-white divide-y divide-gray-200"},eo={class:"px-6 py-4 whitespace-nowrap"},to=["value"],so={class:"px-6 py-4 whitespace-nowrap"},oo={class:"flex items-center"},no={class:"text-sm font-medium text-gray-900"},ro={key:0,class:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800"},lo={class:"text-sm text-gray-500"},io={class:"text-sm font-medium text-gray-900"},ao={class:"px-6 py-4 whitespace-nowrap"},uo={class:"text-sm font-medium text-gray-900"},co={class:"text-sm text-gray-500"},mo={class:"text-sm text-gray-500 truncate max-w-xs"},go={class:"px-6 py-4"},po={class:"text-sm text-gray-900"},xo={class:"font-medium"},vo={key:0,class:"text-gray-500 mt-1"},yo={key:0},fo={key:1,class:"mt-2 space-y-1"},bo={key:0,class:"text-xs text-gray-400"},ho={class:"px-6 py-4 whitespace-nowrap"},wo={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},_o={class:"flex space-x-2"},ko=["onClick"],$o=["onClick"],Co={key:3,class:"p-12 text-center"},jo={__name:"ShippingManagement",setup(d){var G,X;ve();const $=v(!1),_=v(""),c=v([]),f=v([]),h=v({}),x=v([]),y=v(!1),s=v(!1),i=v(!1),u=v(!1),w=v(null),m=v([]),p=v(""),A=v(!1),z=v([]),N=v([]),C=ce({shipping_status:"",order_type:"",search:""}),H=me(()=>c.value.length>0&&x.value.length===c.value.length),Q=((G=window.buygo_admin)==null?void 0:G.api_url)||((X=window.buygo_admin)==null?void 0:X.apiUrl)||"/wp-json/buygo/v1",k=(a,t,l="info")=>{const b={timestamp:new Date().toISOString(),action:a,data:t,level:l};l==="error"?N.value.unshift(b):z.value.unshift(b),z.value.length>50&&(z.value=z.value.slice(0,50)),N.value.length>20&&(N.value=N.value.slice(0,20))},Y=a=>a?new Date(a).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",I=(a,t="success")=>{alert(t==="error"?"錯誤："+a:a)},U=async(a,t={})=>{var M;const l=`${Q}${a}`,B={...{headers:{"Content-Type":"application/json","X-WP-Nonce":((M=window.buygo_admin)==null?void 0:M.nonce)||""}},...t};k("API Request",{url:l,options:B});try{const T=await fetch(l,B),V=await T.json();if(k("API Response",{url:l,status:T.status,data:V}),!T.ok)throw new Error(V.message||`HTTP ${T.status}`);if(!V.success)throw new Error(V.message||"請求失敗");return V}catch(T){throw k("API Error",{url:l,error:T.message},"error"),T}},ee=async()=>{try{const a=await U("/orders/shipping-statuses?include_metadata=true");f.value=a.data,k("載入運送狀態成功",{count:a.data.length})}catch(a){k("載入運送狀態失敗",{error:a.message},"error"),_.value="載入運送狀態失敗："+a.message}},te=async()=>{try{const a=await U("/orders/shipping-statistics");h.value=a.data.statistics||{},k("載入統計資料成功",h.value)}catch(a){k("載入統計資料失敗",{error:a.message},"error")}},D=async()=>{var a;$.value=!0,_.value="";try{const t=new URLSearchParams;C.shipping_status?t.append("shipping_status",C.shipping_status):t.append("shipping_status","pending,preparing,processing"),C.search&&t.append("search",C.search);const l=t.toString(),b=`/orders${l?"?"+l:""}`,B=await U(b);c.value=B.data.map(M=>({...M,formatted_total_amount:se(M.total_amount),shipping_address:oe(M),is_consolidated:M.id&&M.id.toString().includes("MERGED")})),k("載入訂單成功",{count:c.value.length,viewMode:(a=B.meta)==null?void 0:a.view_mode}),await te()}catch(t){_.value=t.message,k("載入訂單失敗",{error:t.message},"error")}finally{$.value=!1}},se=a=>a?`NT$ ${(typeof a=="string"?parseFloat(a):a).toLocaleString("zh-TW")}`:"NT$ 0",oe=a=>[a.shipping_address_1,a.shipping_address_2,a.shipping_city,a.shipping_state].filter(Boolean).join(" "),ne=()=>{D()},re=()=>{H.value?x.value=[]:x.value=c.value.map(a=>a.id)},J=()=>{x.value=[],p.value=""},le=async()=>{if(!(!p.value||x.value.length===0)){A.value=!0;try{const a=await U("/orders/batch/shipping-status",{method:"PUT",body:JSON.stringify({order_ids:x.value,status:p.value,reason:"批量更新"})});k("批量更新成功",a.data),I(`成功更新 ${a.data.success} 個訂單`),await D(),J()}catch(a){k("批量更新失敗",{error:a.message},"error"),I(a.message,"error")}finally{A.value=!1}}},ie=async a=>{w.value=a;try{const t=await U(`/orders/shipping-statuses/available/${a.shipping_status}`);m.value=t.data,s.value=!0}catch(t){k("載入可用狀態失敗",{error:t.message},"error"),I(t.message,"error")}},ae=async()=>{s.value=!1,await D(),I("狀態更新成功")},de=a=>{w.value=a,i.value=!0};return ge(C,()=>{},{deep:!0}),pe(async()=>{await ee(),await D()}),(a,t)=>(o(),n("div",is,[e("div",as,[t[13]||(t[13]=e("div",null,[e("h2",{class:"text-2xl font-bold text-gray-900"},"出貨管理"),e("p",{class:"text-gray-500 text-sm mt-1"},"管理訂單的出貨狀態與物流資訊。")],-1)),e("div",ds,[e("button",{onClick:t[0]||(t[0]=l=>y.value=!y.value),class:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[...t[10]||(t[10]=[e("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})],-1),L(" 篩選 ",-1)])]),e("button",{onClick:D,disabled:$.value,class:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50"},[(o(),n("svg",{class:P(["w-4 h-4 mr-2",{"animate-spin":$.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[11]||(t[11]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])],2)),t[12]||(t[12]=L(" 重新整理 ",-1))],8,us)])]),y.value?(o(),n("div",cs,[e("div",ms,[e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"運送狀態",-1)),O(e("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>C.shipping_status=l),class:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"},[t[14]||(t[14]=e("option",{value:""},"全部狀態",-1)),(o(!0),n(j,null,S(f.value,l=>(o(),n("option",{key:l.key,value:l.key},r(l.label),9,gs))),128))],512),[[F,C.shipping_status]])]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"訂單類型",-1)),O(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>C.order_type=l),class:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"},[...t[16]||(t[16]=[e("option",{value:""},"全部類型",-1),e("option",{value:"normal"},"一般訂單",-1),e("option",{value:"consolidated"},"合併訂單",-1)])],512),[[F,C.order_type]])]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"搜尋",-1)),O(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>C.search=l),type:"text",placeholder:"訂單編號、客戶姓名...",class:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[Z,C.search]])]),e("div",{class:"flex items-end"},[e("button",{onClick:ne,class:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm font-medium"}," 套用篩選 ")])])])):g("",!0),e("div",ps,[e("div",xs,[e("div",vs,[e("div",ys,[t[20]||(t[20]=e("div",{class:"flex-shrink-0"},[e("div",{class:"w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])])],-1)),e("div",fs,[e("dl",null,[t[19]||(t[19]=e("dt",{class:"text-sm font-medium text-gray-500 truncate"},"待出貨",-1)),e("dd",bs,r(h.value.pending||0),1)])])])])]),e("div",hs,[e("div",ws,[e("div",_s,[t[22]||(t[22]=e("div",{class:"flex-shrink-0"},[e("div",{class:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})])])],-1)),e("div",ks,[e("dl",null,[t[21]||(t[21]=e("dt",{class:"text-sm font-medium text-gray-500 truncate"},"處理中",-1)),e("dd",$s,r(h.value.processing||0),1)])])])])]),e("div",Cs,[e("div",js,[e("div",Ss,[t[24]||(t[24]=e("div",{class:"flex-shrink-0"},[e("div",{class:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])])],-1)),e("div",Ms,[e("dl",null,[t[23]||(t[23]=e("dt",{class:"text-sm font-medium text-gray-500 truncate"},"已出貨",-1)),e("dd",Ls,r(h.value.shipped||0),1)])])])])]),e("div",As,[e("div",Bs,[e("div",Ts,[t[26]||(t[26]=e("div",{class:"flex-shrink-0"},[e("div",{class:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])])],-1)),e("div",Os,[e("dl",null,[t[25]||(t[25]=e("dt",{class:"text-sm font-medium text-gray-500 truncate"},"已完成",-1)),e("dd",Ds,r(h.value.completed||0),1)])])])])])]),x.value.length>0?(o(),n("div",zs,[e("div",Ns,[e("div",Us,[e("span",Vs," 已選擇 "+r(x.value.length)+" 個訂單 ",1)]),e("div",Ps,[O(e("select",{"onUpdate:modelValue":t[4]||(t[4]=l=>p.value=l),class:"border border-blue-300 rounded-md px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"},[t[27]||(t[27]=e("option",{value:""},"選擇狀態",-1)),(o(!0),n(j,null,S(f.value,l=>(o(),n("option",{key:l.key,value:l.key},r(l.label),9,Is))),128))],512),[[F,p.value]]),e("button",{onClick:le,disabled:!p.value||A.value,class:"px-4 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm font-medium disabled:opacity-50"},[A.value?(o(),n("span",qs,"更新中...")):(o(),n("span",Ws,"批量更新"))],8,Es),e("button",{onClick:J,class:"px-4 py-1 bg-gray-600 text-white rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 text-sm font-medium"}," 取消選擇 ")])])])):g("",!0),e("div",Fs,[$.value?(o(),n("div",Rs,[...t[28]||(t[28]=[e("div",{class:"inline-flex items-center"},[e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),L(" 載入中... ")],-1)])])):_.value?(o(),n("div",Hs,[t[29]||(t[29]=e("div",{class:"text-red-600 mb-4"},[e("svg",{class:"mx-auto h-12 w-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),t[30]||(t[30]=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"載入失敗",-1)),e("p",Js,r(_.value),1),e("button",{onClick:D,class:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700"}," 重試 ")])):c.value.length>0?(o(),n("div",Gs,[e("table",Xs,[e("thead",Zs,[e("tr",null,[e("th",Ks,[e("input",{type:"checkbox",checked:H.value,onChange:re,class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,40,Qs)]),t[31]||(t[31]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," 訂單資訊 ",-1)),t[32]||(t[32]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," 客戶資訊 ",-1)),t[33]||(t[33]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," 商品資訊 ",-1)),t[34]||(t[34]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," 運送狀態 ",-1)),t[35]||(t[35]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," 操作 ",-1))])]),e("tbody",Ys,[(o(!0),n(j,null,S(c.value,l=>(o(),n("tr",{key:l.id,class:"hover:bg-gray-50"},[e("td",eo,[O(e("input",{type:"checkbox",value:l.id,"onUpdate:modelValue":t[5]||(t[5]=b=>x.value=b),class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,8,to),[[xe,x.value]])]),e("td",so,[e("div",oo,[e("div",null,[e("div",no,[L(r(l.order_number)+" ",1),l.is_consolidated?(o(),n("span",ro," 合併訂單 ")):g("",!0)]),e("div",lo,r(Y(l.created_at)),1),e("div",io,r(l.formatted_total_amount),1)])])]),e("td",ao,[e("div",uo,r(l.customer_name),1),e("div",co,r(l.customer_phone),1),e("div",mo,r(l.shipping_address),1)]),e("td",go,[e("div",po,[e("div",xo,r(l.item_count)+" 個商品",1),l.sellers&&l.sellers.length>0?(o(),n("div",vo,[t[36]||(t[36]=L(" 賣家： ",-1)),(o(!0),n(j,null,S(l.sellers,(b,B)=>(o(),n("span",{key:b.id},[L(r(b.name),1),B<l.sellers.length-1?(o(),n("span",yo,", ")):g("",!0)]))),128))])):g("",!0),l.items&&l.items.length>0?(o(),n("div",fo,[(o(!0),n(j,null,S(l.items.slice(0,2),b=>(o(),n("div",{key:b.id,class:"text-xs text-gray-500"},r(b.product_name)+" × "+r(b.quantity),1))),128)),l.items.length>2?(o(),n("div",bo," 還有 "+r(l.items.length-2)+" 個商品... ",1)):g("",!0)])):g("",!0)])]),e("td",ho,[E(q,{status:l.shipping_status},null,8,["status"])]),e("td",wo,[e("div",_o,[e("button",{onClick:b=>de(l),class:"text-blue-600 hover:text-blue-900"}," 查看 ",8,ko),e("button",{onClick:b=>ie(l),class:"text-green-600 hover:text-green-900"}," 更新狀態 ",8,$o)])])]))),128))])])])):(o(),n("div",Co,[...t[37]||(t[37]=[e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})],-1),e("h3",{class:"mt-4 text-lg font-medium text-gray-900"},"沒有找到訂單",-1),e("p",{class:"mt-2 text-sm text-gray-500"},"目前沒有符合條件的待出貨訂單。",-1)])]))]),s.value?(o(),W(De,{key:2,order:w.value,"available-statuses":m.value,onClose:t[6]||(t[6]=l=>s.value=!1),onUpdated:ae},null,8,["order","available-statuses"])):g("",!0),i.value?(o(),W(St,{key:3,order:w.value,onClose:t[7]||(t[7]=l=>i.value=!1)},null,8,["order"])):g("",!0),u.value?(o(),W(ls,{key:4,"api-logs":z.value,"error-logs":N.value,onClose:t[8]||(t[8]=l=>u.value=!1)},null,8,["api-logs","error-logs"])):g("",!0),e("button",{onClick:t[9]||(t[9]=l=>u.value=!u.value),class:"fixed bottom-4 right-4 bg-gray-800 text-white p-3 rounded-full shadow-lg hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500",title:"除錯面板"},[...t[38]||(t[38]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"})],-1)])])]))}},Lo=K(jo,[["__scopeId","data-v-d2e10511"]]);export{Lo as default};
