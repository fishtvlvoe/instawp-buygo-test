import{r as v,d as L,c as a,a as e,g as p,z as A,A as H,B as U,k as h,t as r,m as u,F as w,l as k,i as C,J as O,I as N,D,o as n}from"./main-CKplmvXD.js";const W={class:"space-y-6"},F={class:"flex items-center justify-between"},I={class:"flex items-center gap-4"},J={class:"text-xl font-bold text-gray-900 flex items-center gap-3"},X={key:0,class:"text-sm text-gray-500 mt-1"},q={key:0,class:"flex gap-3"},R={key:0,class:"py-12 flex justify-center"},G={key:1,class:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg shadow-sm"},K={key:2,class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Q={class:"lg:col-span-2 space-y-6"},Y={class:"bg-white shadow-sm rounded-lg border border-gray-200 overflow-hidden"},Z={role:"list",class:"divide-y divide-gray-100"},ee={class:"h-16 w-16 flex-shrink-0 overflow-hidden rounded-md border border-gray-200 bg-gray-50 flex items-center justify-center"},te=["src"],se={key:1,class:"h-8 w-8 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},oe={class:"ml-4 flex-1"},re={class:"text-sm font-bold text-gray-900"},ae={key:0,class:"text-sm text-gray-500 mt-1"},ne={class:"ml-4 text-right"},le={class:"text-sm font-bold text-gray-900"},ie={class:"text-xs text-gray-500 mt-1"},de={class:"bg-gray-50/50 px-6 py-4 border-t border-gray-200"},ce={class:"flex justify-between items-center"},ue={class:"text-xl font-bold text-gray-900"},ge={key:0,class:"bg-white shadow-sm rounded-lg border border-gray-200 overflow-hidden"},pe={class:"p-6 text-sm text-gray-700 leading-relaxed"},ye={class:"space-y-6"},ve={class:"bg-white shadow-sm rounded-lg border border-gray-200 overflow-hidden"},he={class:"p-6"},me={class:"flex items-center mb-6"},fe=["src"],be={key:1,class:"h-12 w-12 rounded-full bg-gray-100 flex items-center justify-center text-lg font-bold text-gray-600"},xe={class:"ml-3"},_e={class:"text-sm font-bold text-gray-900"},we={class:"space-y-4 text-sm"},ke={class:"flex items-start"},Ce={class:"ml-3 text-gray-600 break-all"},je={key:0,class:"flex items-start"},Te={class:"ml-3 text-gray-600"},Ne={class:"bg-white shadow-sm rounded-lg border border-gray-200 overflow-hidden"},Ve={class:"p-6 text-sm text-gray-600"},ze={key:0,class:"space-y-1"},Me={class:"text-gray-900 font-medium"},Se={key:1,class:"text-gray-400 italic"},Be={class:"bg-white shadow-sm rounded-lg border border-gray-200 overflow-hidden"},Ee={class:"p-6 flex flex-col items-center gap-4"},Pe=["disabled"],$e={key:0,class:"flex items-center justify-center"},Le={key:1},Ae={class:"bg-white shadow-sm rounded-lg border border-gray-200 overflow-hidden"},He={class:"p-6 flex flex-col items-center gap-4"},Ue=["disabled"],Oe={key:0,class:"flex items-center justify-center"},De={key:1},We={class:"bg-white shadow-sm rounded-lg border border-gray-200 overflow-hidden"},Fe={class:"p-6 space-y-4"},Ie={key:0,class:"mb-4 space-y-2"},Je={class:"flex items-center gap-1"},Xe={class:"text-gray-400"},qe={class:"text-gray-400"},Re={class:"flex gap-4"},Ge={class:"inline-flex items-center"},Ke={class:"inline-flex items-center"},Qe=["disabled"],Ye={key:0,class:"flex items-center justify-center"},Ze={key:1},st={__name:"OrderDetail",setup(et){const V=D(),s=v(null),x=v(!0),f=v(null),g=v(!1),b=v(!1),c=v("shipped"),m=v(["line"]),j=async()=>{x.value=!0;try{const o=window.buygo_frontend||window.buygo_admin;if(!o||!o.api_url)throw new Error("API Config Missing");const t={"X-WP-Nonce":o.nonce,"Content-Type":"application/json"},i=V.params.id,d=`${o.api_url}/stats/seller-orders/${i}`,l=await fetch(d,{headers:t,credentials:"same-origin"});if(!l.ok)throw new Error(`HTTP ${l.status}`);const y=await l.json();y.success?(s.value=y.data,s.value.shipping_status==="shipped"?c.value="shipped":s.value.payment_status==="paid"&&(c.value="payment_received")):f.value=y.message||"Failed to load order"}catch(o){console.error("Fetch Error",o),f.value=o.message}finally{x.value=!1}},z=o=>({completed:"已完成",processing:"處理中",pending:"待處理",cancelled:"已取消","on-hold":"等待付款",failed:"失敗",refunded:"已退款"})[o]||o,M=o=>({order_shipped:"已出貨",order_paid:"已付款",order_cancelled:"已取消",order_arrived:"已到貨"})[o]||o,S=o=>o?new Date(o).toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit"}):"",_=o=>{if(!s.value||!s.value.notification_history)return!1;let t=o;return o==="shipped"&&(t="order_shipped"),o==="payment_received"&&(t="order_paid"),s.value.notification_history.some(i=>i.type===t&&i.status==="sent")},B=o=>{switch(o){case"completed":return"bg-green-50 text-green-700 border-green-200";case"processing":return"bg-blue-50 text-blue-700 border-blue-200";case"on-hold":return"bg-orange-50 text-orange-700 border-orange-200";case"pending":return"bg-gray-50 text-gray-600 border-gray-200";default:return"bg-gray-50 text-gray-800 border-gray-200"}},E=async()=>{if(!s.value)return;g.value=!0;const o=s.value.shipping_status==="shipped"?"pending":"shipped";try{const t=window.buygo_frontend||window.buygo_admin,i={"X-WP-Nonce":t.nonce,"Content-Type":"application/json"},d=`${t.api_url}/stats/seller-orders/${s.value.id}/shipment`;if(!(await fetch(d,{method:"PUT",headers:i,body:JSON.stringify({status:o})})).ok)throw new Error("Update failed");s.value.shipping_status=o,o==="shipped"&&(c.value="shipped")}catch(t){alert("更新失敗: "+t.message)}finally{g.value=!1}},P=async()=>{if(!s.value)return;g.value=!0;const o=s.value.payment_status==="paid"?"pending":"paid";try{const t=window.buygo_frontend||window.buygo_admin,i={"X-WP-Nonce":t.nonce,"Content-Type":"application/json"},d=`${t.api_url}/stats/seller-orders/${s.value.id}/payment`;if(!(await fetch(d,{method:"PUT",headers:i,body:JSON.stringify({status:o})})).ok)throw new Error("Update failed");s.value.payment_status=o,o==="paid"?(s.value.status="processing",c.value="payment_received"):s.value.status="on-hold"}catch(t){alert("更新失敗: "+t.message)}finally{g.value=!1}},$=async()=>{if(s.value){b.value=!0;try{const o=window.buygo_frontend||window.buygo_admin,t={"X-WP-Nonce":o.nonce,"Content-Type":"application/json"},i=`${o.api_url}/stats/seller-orders/${s.value.id}/notify`,d=await fetch(i,{method:"POST",headers:t,body:JSON.stringify({type:c.value,channels:m.value})});if(!d.ok)throw new Error("Send failed");const l=await d.json();if(l.success)await j();else throw new Error(l.message)}catch(o){alert("發送失敗: "+o.message)}finally{b.value=!1}}};return L(()=>{j()}),(o,t)=>{var d;const i=U("router-link");return n(),a("div",W,[e("div",F,[e("div",I,[A(i,{to:"/sc/orders",class:"p-2 -ml-2 text-gray-400 hover:text-gray-900 rounded-full hover:bg-gray-100 transition-colors"},{default:H(()=>[...t[3]||(t[3]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])]),_:1}),e("div",null,[e("h1",J,[h(" 訂單 "+r((d=s.value)==null?void 0:d.order_number)+" ",1),s.value?(n(),a("span",{key:0,class:u(["inline-flex items-center rounded-full px-2.5 py-0.5 text-sm font-medium border",B(s.value.status)])},r(z(s.value.status)),3)):p("",!0)]),s.value?(n(),a("p",X,r(s.value.created_at),1)):p("",!0)])]),s.value?(n(),a("div",q)):p("",!0)]),x.value?(n(),a("div",R,[...t[4]||(t[4]=[e("svg",{class:"animate-spin h-8 w-8 text-gray-900",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):f.value?(n(),a("div",G,r(f.value),1)):s.value?(n(),a("div",K,[e("div",Q,[e("div",Y,[t[7]||(t[7]=e("div",{class:"px-6 py-4 border-b border-gray-200 bg-gray-50/50"},[e("h3",{class:"text-lg font-bold text-gray-900"},"商品明細")],-1)),e("ul",Z,[(n(!0),a(w,null,k(s.value.items,l=>(n(),a("li",{key:l.id,class:"p-6 flex items-center hover:bg-gray-50 transition-colors"},[e("div",ee,[l.image?(n(),a("img",{key:0,src:l.image,class:"h-full w-full object-cover"},null,8,te)):(n(),a("svg",se,[...t[5]||(t[5]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)])]))]),e("div",oe,[e("h4",re,r(l.name),1),l.meta?(n(),a("p",ae,[(n(!0),a(w,null,k(l.meta,(y,T)=>(n(),a("span",{key:T,class:"mr-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800"},r(T)+": "+r(y),1))),128))])):p("",!0)]),e("div",ne,[e("p",le,r(s.value.totals.currency)+" "+r(l.total),1),e("p",ie,"數量: "+r(l.quantity),1)])]))),128))]),e("div",de,[e("div",ce,[t[6]||(t[6]=e("p",{class:"text-sm font-medium text-gray-500"},"訂單總計",-1)),e("p",ue,r(s.value.totals.currency)+" "+r(s.value.totals.total),1)])])]),s.value.notes?(n(),a("div",ge,[t[8]||(t[8]=e("div",{class:"px-6 py-4 border-b border-gray-200 bg-gray-50/50"},[e("h3",{class:"text-lg font-bold text-gray-900"},"備註")],-1)),e("div",pe,r(s.value.notes),1)])):p("",!0)]),e("div",ye,[e("div",ve,[t[12]||(t[12]=e("div",{class:"px-6 py-4 border-b border-gray-200 bg-gray-50/50"},[e("h3",{class:"text-lg font-bold text-gray-900"},"顧客資訊")],-1)),e("div",he,[e("div",me,[s.value.customer.avatar_url?(n(),a("img",{key:0,src:s.value.customer.avatar_url,class:"h-12 w-12 rounded-full border border-gray-200"},null,8,fe)):(n(),a("div",be,r(s.value.customer.name.charAt(0)),1)),e("div",xe,[e("h4",_e,r(s.value.customer.name),1),t[9]||(t[9]=e("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800 mt-1"}," 顧客 ",-1))])]),e("div",we,[e("div",ke,[t[10]||(t[10]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})])],-1)),e("span",Ce,r(s.value.customer.email),1)]),s.value.customer.phone?(n(),a("div",je,[t[11]||(t[11]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})])],-1)),e("span",Te,r(s.value.customer.phone),1)])):p("",!0)])])]),e("div",Ne,[t[13]||(t[13]=e("div",{class:"px-6 py-4 border-b border-gray-200 bg-gray-50/50"},[e("h3",{class:"text-lg font-bold text-gray-900"},"收件地址")],-1)),e("div",Ve,[s.value.customer.shipping_address.address_1?(n(),a("div",ze,[e("p",Me,r(s.value.customer.shipping_address.address_1),1),e("p",null,r(s.value.customer.shipping_address.city)+", "+r(s.value.customer.shipping_address.state)+" "+r(s.value.customer.shipping_address.postcode),1),e("p",null,r(s.value.customer.shipping_address.country),1)])):(n(),a("div",Se," 與帳單地址相同或未提供 "))])]),e("div",Be,[t[15]||(t[15]=e("div",{class:"px-6 py-4 border-b border-gray-200 bg-gray-50/50"},[e("h3",{class:"text-lg font-bold text-gray-900"},"付款狀態")],-1)),e("div",Ee,[e("div",{class:u(["inline-flex items-center rounded-full px-4 py-1 text-sm font-bold border transition-colors duration-200",s.value.payment_status==="paid"?"bg-green-50 text-green-700 border-green-200":"bg-orange-50 text-orange-700 border-orange-200"])},[e("span",{class:u(["w-2 h-2 rounded-full mr-2",s.value.payment_status==="paid"?"bg-green-500":"bg-orange-500"])},null,2),h(" "+r(s.value.payment_status==="paid"?"已付款":"未付款"),1)],2),e("button",{onClick:P,disabled:g.value,class:u(["w-full rounded-md px-4 py-2.5 text-sm font-semibold shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 transition-all duration-200",s.value.payment_status==="paid"?"bg-white text-red-700 border border-gray-200 hover:bg-red-50 hover:border-red-200":"bg-gray-900 text-white hover:bg-gray-800 border-transparent"])},[g.value?(n(),a("span",$e,[...t[14]||(t[14]=[e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-current",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),h(" 處理中... ",-1)])])):(n(),a("span",Le,r(s.value.payment_status==="paid"?"標示為未付款":"標示為已付款"),1))],10,Pe)])]),e("div",Ae,[t[17]||(t[17]=e("div",{class:"px-6 py-4 border-b border-gray-200 bg-gray-50/50"},[e("h3",{class:"text-lg font-bold text-gray-900"},"物流狀態")],-1)),e("div",He,[e("div",{class:u(["inline-flex items-center rounded-full px-4 py-1 text-sm font-bold border transition-colors duration-200",s.value.shipping_status==="shipped"?"bg-green-50 text-green-700 border-green-200":"bg-gray-50 text-gray-600 border-gray-200"])},[e("span",{class:u(["w-2 h-2 rounded-full mr-2",s.value.shipping_status==="shipped"?"bg-green-500":"bg-gray-400"])},null,2),h(" "+r(s.value.shipping_status==="shipped"?"已出貨":"未出貨"),1)],2),e("button",{onClick:E,disabled:g.value,class:u(["w-full rounded-md px-4 py-2.5 text-sm font-semibold shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 transition-all duration-200",s.value.shipping_status==="shipped"?"bg-white text-red-700 border border-gray-200 hover:bg-red-50 hover:border-red-200":"bg-gray-900 text-white hover:bg-gray-800 border-transparent"])},[g.value?(n(),a("span",Oe,[...t[16]||(t[16]=[e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-current",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),h(" 處理中... ",-1)])])):(n(),a("span",De,r(s.value.shipping_status==="shipped"?"標示為未出貨":"標示為已出貨"),1))],10,Ue)])]),e("div",We,[t[24]||(t[24]=e("div",{class:"px-6 py-4 border-b border-gray-200 bg-gray-50/50"},[e("h3",{class:"text-lg font-bold text-gray-900"},"推播通知")],-1)),e("div",Fe,[s.value.notification_history&&s.value.notification_history.length>0?(n(),a("div",Ie,[(n(!0),a(w,null,k(s.value.notification_history,(l,y)=>(n(),a("div",{key:y,class:"text-xs bg-gray-50 p-2 rounded border border-gray-100 flex justify-between items-center text-gray-600"},[e("span",Je,[e("span",{class:u(["w-1.5 h-1.5 rounded-full",l.status==="sent"?"bg-green-400":"bg-red-400"])},null,2),h(" "+r(M(l.type))+" ",1),e("span",Xe,"("+r(l.channel)+")",1)]),e("span",qe,r(S(l.sent_at)),1)]))),128))])):p("",!0),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"通知類型",-1)),C(e("select",{"onUpdate:modelValue":t[0]||(t[0]=l=>c.value=l),class:"block w-full border-gray-300 rounded-md shadow-sm text-sm focus:border-indigo-500 focus:ring-indigo-500"},[...t[18]||(t[18]=[e("option",{value:"shipped"},"已出貨通知",-1),e("option",{value:"payment_received"},"已付款通知",-1),e("option",{value:"cancelled"},"已取消通知",-1)])],512),[[O,c.value]])]),e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"發送管道",-1)),e("div",Re,[e("label",Ge,[C(e("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=l=>m.value=l),value:"line",class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},null,512),[[N,m.value]]),t[20]||(t[20]=e("span",{class:"ml-2 text-sm text-gray-600"},"LINE",-1))]),e("label",Ke,[C(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=l=>m.value=l),value:"email",class:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},null,512),[[N,m.value]]),t[21]||(t[21]=e("span",{class:"ml-2 text-sm text-gray-600"},"Email",-1))])])]),e("button",{onClick:$,disabled:b.value||m.value.length===0||_(c.value),class:u(["w-full rounded-md px-4 py-2.5 text-sm font-semibold shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 transition-all duration-200",_(c.value)?"bg-gray-100 text-gray-400 border border-gray-200 cursor-not-allowed":"bg-gray-900 text-white hover:bg-black border-transparent"])},[b.value?(n(),a("span",Ye,[...t[23]||(t[23]=[e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-current",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),h(" 發送中... ",-1)])])):(n(),a("span",Ze,r(_(c.value)?"已發送":"發送通知"),1))],10,Qe)])])])])):p("",!0)])}}};export{st as default};
